% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/prep_utils.R
\name{run_prep_step}
\alias{run_prep_step}
\title{Run a prep step with error handling}
\usage{
run_prep_step(state, prep_name, fn, quiet)
}
\arguments{
\item{state}{The goodpractice state list, passed through the prep
pipeline.}

\item{prep_name}{Character scalar. Name for this prep step, used as
the key in \code{state} and in the warning message on failure.}

\item{fn}{A zero-argument function containing the actual work.
Its return value is stored in \code{state[[prep_name]]}.}

\item{quiet}{Logical. Passed to \code{\link[=try]{try()}} as \code{silent}.}
}
\value{
The updated \code{state} list.
}
\description{
Executes \code{fn()} inside \code{\link[=try]{try()}}, stores the result in
\code{state[[prep_name]]}, and emits a warning if the step fails.
Use this when writing new prep functions to avoid duplicating
the try/warning boilerplate.
}
\section{Writing a new prep}{

\enumerate{
\item Create \verb{R/prep_<name>.R}
\item Register the prep and call \code{run_prep_step()}:
}

\if{html}{\out{<div class="sourceCode">}}\preformatted{PREPS$myprep <- function(state, path = state$path, quiet) \{
  run_prep_step(state, "myprep", function() \{
    do_work(path)
  \}, quiet = quiet)
\}
}\if{html}{\out{</div>}}
\enumerate{
\item If you need post-processing on success, capture the returned
state and check \code{!inherits(state$myprep, "try-error")} before
doing additional work (see \code{prep_covr.R} for an example).
}
}

\keyword{internal}
